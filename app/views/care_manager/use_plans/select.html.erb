<h1>問い合わせ先施設選択</h1>

<div class="row form-inline my-3">
  <%= form_with url: select_care_manager_use_plan_path(@use_plan), method: :get do |f| %>
    <%= f.search_field :word, placeholder: "ここへ入力して検索！", class: 'col form-control' %>
    <%= f.select :search, options_for_select([["と一致する","perfect_match"], ["から始まる","forward_match"],  ["で終わる","backward_match"], ["を含む","partial_match"]], "partial_match"), {}, class: 'col custom-select' %>
    <%= f.select :range, options_for_select( { '施設名' => 'Name', '住所' => 'Adress' }, 'Adress'), {}, class: 'col custom-select' %>
    を
    <%= f.submit "検索", class: "btn btn-primary" %>
  <% end %>
</div>

<div class="row mb-4">
  <div class="col col-md-12">
    <table class="table table-bordered table-responsive-md shadow">
      <thead>
        <tr>
          <th class="table-active">施設名</th>
          <th class="table-active">住所</th>
          <th class="table-active"><%= "利用期間（#{@use_plan.start_date}〜#{@use_plan.end_date}）の空き状況" %></th>
        </tr>
      </thead>
      <tbody>
        <% @facilities.each do |facility| %>
          <tr>
            <td class="col col-md-1 text-center text-nowrap">
              <%= facility.name %>
            </td>
            <td class="col col-md-2 text-center text-nowrap">
              <%= facility.address %>
            </td>
            <td class="col col-md-1 text-center text-nowrap">
              <% if facility.no_beds?(@use_plan) %>
                満床のため問い合わせできません。
              <% else %>
                <% if false %><%= button_to "問い合わせする", care_manager_use_plan_booking_contacts_path(@use_plan, @booking_contact, facility_id: facility.id), method: :post, data: { confirm: "#{facility.name}へ問い合わせを送信してよろしいですか？" }, class: "btn btn-success" %><% end %>
                <%= form_with model: @booking_contact, url: care_manager_use_plan_booking_contacts_path(@use_plan) do |f| %>
                  空きあり
                  <%= f.hidden_field :facility_id, :value => facility.id %>
                  <%= f.submit "問い合わせを送信", data: { confirm: "#{facility.name}へ問い合わせを送信してよろしいですか？" }, class: "btn btn-success" %>
                <% end %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>


<h1>利用計画詳細</h1>
<div class="row py-3">
  <div class="col">
    <%= link_to "編集する", edit_care_manager_use_plan_path(@use_plan), class: "btn btn-success btn-sm px-3 col-md-2 shadow" %>
  </div>
  <div class="col">
    <%= link_to "問い合わせ先を選択する", select_care_manager_use_plan_path(@use_plan), class: "btn btn-success btn-sm px-3 col-md-2 shadow" %>
  </div>
</div>
<div class="row mb-4">
  <div class="col-md-8">
    <table class="table table-bordered table-responsive-md shadow">
      <tr>
        <th class="table-active text-nowrap" style="width:25%">ご利用者様</td>
        <td style="width:75%">
          <%= link_to @use_plan.user.full_name, care_manager_user_path(@use_plan.user) %>
        </td>
      </tr>
      <tr>
        <th class="table-active text-nowrap">入所日</td>
        <td><%= @use_plan.start_date %></td>
      </tr>
      <tr>
        <th class="table-active text-nowrap">退所日</td>
        <td><%= @use_plan.end_date %></td>
      </tr>
      <tr>
        <th class="table-active text-nowrap">状態</td>
        <td><%= @use_plan.status_i18n %></td>
      </tr>
      <tr>
        <th class="table-active text-nowrap">利用先施設</td>
        <td>
          <% if @use_plan.facility_id.nil? %>
            未定
          <% else %>
            <%= @use_plan.facility.name %>
          <% end %>
        </td>
      </tr>
      <tr>
        <th class="table-active text-nowrap">作成者</td>
        <td><%= @use_plan.care_manager.full_name %></td>
      </tr>
      <tr>
        <th class="table-active text-nowrap">居宅介護支援事業所名</td>
        <td><%= current_care_manager.office_name %></td>
      </tr>
    </table>
  </div>
</div>